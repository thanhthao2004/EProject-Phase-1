# E-COMMERCE MICROSERVICES PROJECT - T√ÄI LI·ªÜU CHI TI·∫æT

## üìã T·ªîNG QUAN D·ª∞ √ÅN

ƒê√¢y l√† m·ªôt h·ªá th·ªëng E-commerce ƒë∆∞·ª£c x√¢y d·ª±ng theo ki·∫øn tr√∫c **Microservices** v·ªõi 4 services ch√≠nh:
- **API Gateway** (Port 3003): ƒêi·ªÅu h∆∞·ªõng requests
- **Auth Service** (Port 3000): X√°c th·ª±c ng∆∞·ªùi d√πng
- **Product Service** (Port 3001): Qu·∫£n l√Ω s·∫£n ph·∫©m
- **Order Service** (Port 3002): X·ª≠ l√Ω ƒë∆°n h√†ng

## üèóÔ∏è KI·∫æN TR√öC H·ªÜ TH·ªêNG

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CLIENT                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  API GATEWAY                                ‚îÇ
‚îÇ                   (Port 3003)                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ             ‚îÇ             ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ AUTH SERVICE ‚îÇ ‚îÇ PRODUCT ‚îÇ ‚îÇ ORDER       ‚îÇ
‚îÇ (Port 3000)  ‚îÇ ‚îÇ SERVICE ‚îÇ ‚îÇ SERVICE     ‚îÇ
‚îÇ              ‚îÇ ‚îÇ(Port    ‚îÇ ‚îÇ (Port 3002) ‚îÇ
‚îÇ              ‚îÇ ‚îÇ 3001)   ‚îÇ ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ             ‚îÇ             ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ     MONGODB DATABASE     ‚îÇ
        ‚îÇ   (3 Collections)        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ      RABBITMQ            ‚îÇ
        ‚îÇ   (Message Broker)       ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ LU·ªíNG HO·∫†T ƒê·ªòNG CHI TI·∫æT

### 1. **API GATEWAY** (`api-gateway/index.js`)

**Ch·ª©c nƒÉng:** ƒêi·ªÅu h∆∞·ªõng t·∫•t c·∫£ requests t·ª´ client ƒë·∫øn c√°c microservices

**Lu·ªìng code:**
```javascript
// D√≤ng 1-4: Import dependencies
const express = require("express");
const httpProxy = require("http-proxy");

// D√≤ng 5-6: Kh·ªüi t·∫°o proxy server v√† Express app
const proxy = httpProxy.createProxyServer();
const app = express();

// D√≤ng 7: Comment gi·∫£i th√≠ch internal URIs
// D√≤ng 8-10: Route /auth requests ƒë·∫øn auth service
app.use("/auth", (req, res) => {
  proxy.web(req, res, { target: "http://auth:3000" });
});

// D√≤ng 12-15: Route /products requests ƒë·∫øn product service  
app.use("/products", (req, res) => {
  proxy.web(req, res, { target: "http://product:3001" });
});

// D√≤ng 17-20: Route /orders requests ƒë·∫øn order service
app.use("/orders", (req, res) => {
  proxy.web(req, res, { target: "http://order:3002" });
});

// D√≤ng 22-26: Kh·ªüi ƒë·ªông server tr√™n port 3003
const port = process.env.PORT || 3003;
app.listen(port, () => {
  console.log(`API Gateway listening on port ${port}`);
});
```

### 2. **AUTH SERVICE** - X√°c th·ª±c ng∆∞·ªùi d√πng

#### **2.1 Entry Point** (`auth/index.js`)
```javascript
// D√≤ng 1: Load environment variables
require("dotenv").config();

// D√≤ng 2-5: Import v√† kh·ªüi t·∫°o App class
const App = require("./src/app");
const app = new App();
app.start();
```

#### **2.2 App Class** (`auth/src/app.js`)
```javascript
// D√≤ng 1-5: Import dependencies
const express = require("express");
const mongoose = require("mongoose");
const config = require("./config");
const authMiddleware = require("./middlewares/authMiddleware");
const AuthController = require("./controllers/authController");

// D√≤ng 7-14: Constructor - kh·ªüi t·∫°o app, controller, connect DB, set middlewares v√† routes
class App {
  constructor() {
    this.app = express();
    this.authController = new AuthController();
    this.connectDB();
    this.setMiddlewares();
    this.setRoutes();
  }

  // D√≤ng 16-22: K·∫øt n·ªëi MongoDB
  async connectDB() {
    await mongoose.connect(config.mongoURI, {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });
    console.log("MongoDB connected");
  }

  // D√≤ng 29-32: Set up middlewares (JSON parsing)
  setMiddlewares() {
    this.app.use(express.json());
    this.app.use(express.urlencoded({ extended: false }));
  }

  // D√≤ng 34-38: ƒê·ªãnh nghƒ©a routes
  setRoutes() {
    this.app.post("/login", (req, res) => this.authController.login(req, res));
    this.app.post("/register", (req, res) => this.authController.register(req, res));
    this.app.get("/dashboard", authMiddleware, (req, res) => res.json({ message: "Welcome to dashboard" }));
  }

  // D√≤ng 40-42: Kh·ªüi ƒë·ªông server tr√™n port 3000
  start() {
    this.server = this.app.listen(3000, () => console.log("Server started on port 3000"));
  }
}
```

#### **2.3 Auth Controller** (`auth/src/controllers/authController.js`)

**Login Flow:**
```javascript
// D√≤ng 12-22: Login method
async login(req, res) {
  // D√≤ng 13: Extract username v√† password t·ª´ request body
  const { username, password } = req.body;

  // D√≤ng 15: G·ªçi authService.login() ƒë·ªÉ x√°c th·ª±c
  const result = await this.authService.login(username, password);

  // D√≤ng 17-21: Tr·∫£ v·ªÅ token n·∫øu th√†nh c√¥ng, error n·∫øu th·∫•t b·∫°i
  if (result.success) {
    res.json({ token: result.token });
  } else {
    res.status(400).json({ message: result.message });
  }
}
```

**Register Flow:**
```javascript
// D√≤ng 24-40: Register method
async register(req, res) { 
  // D√≤ng 25: L·∫•y user data t·ª´ request body
  const user = req.body;

  try {
    // D√≤ng 28: Ki·ªÉm tra username ƒë√£ t·ªìn t·∫°i ch∆∞a
    const existingUser = await this.authService.findUserByUsername(user.username);

    // D√≤ng 30-33: N·∫øu username ƒë√£ t·ªìn t·∫°i, throw error
    if (existingUser) {
      console.log("Username already taken")
      throw new Error("Username already taken");
    }

    // D√≤ng 35-36: T·∫°o user m·ªõi v√† tr·∫£ v·ªÅ k·∫øt qu·∫£
    const result = await this.authService.register(user);
    res.json(result);
  } catch (err) {
    // D√≤ng 37-39: Handle error
    res.status(400).json({ message: err.message });
  }
}
```

#### **2.4 Auth Service** (`auth/src/services/authService.js`)

**Login Logic:**
```javascript
// D√≤ng 20-36: Login method
async login(username, password) {
  // D√≤ng 21: T√¨m user theo username
  const user = await this.userRepository.getUserByUsername(username);

  // D√≤ng 23-25: N·∫øu kh√¥ng t√¨m th·∫•y user, return error
  if (!user) {
    return { success: false, message: "Invalid username or password" };
  }

  // D√≤ng 27-31: So s√°nh password v·ªõi bcrypt
  const isMatch = await bcrypt.compare(password, user.password);
  if (!isMatch) {
    return { success: false, message: "Invalid username or password" };
  }

  // D√≤ng 33-35: T·∫°o JWT token v√† return success
  const token = jwt.sign({ id: user._id }, config.jwtSecret);
  return { success: true, token };
}
```

**Register Logic:**
```javascript
// D√≤ng 38-43: Register method
async register(user) {
  // D√≤ng 39: T·∫°o salt cho bcrypt
  const salt = await bcrypt.genSalt(10);
  
  // D√≤ng 40: Hash password v·ªõi salt
  user.password = await bcrypt.hash(user.password, salt);

  // D√≤ng 42: T·∫°o user trong database
  return await this.userRepository.createUser(user);
}
```

#### **2.5 User Model** (`auth/src/models/user.js`)
```javascript
// D√≤ng 1-2: Import mongoose
const mongoose = require("mongoose");

// D√≤ng 4-13: ƒê·ªãnh nghƒ©a User Schema
const UserSchema = new mongoose.Schema({
  username: {
    type: String,
    required: true
  },
  password: {
    type: String,
    required: true
  }
});

// D√≤ng 15: Export User model
module.exports = mongoose.model("User", UserSchema);
```

#### **2.6 Auth Middleware** (`auth/src/middlewares/authMiddleware.js`)
```javascript
// D√≤ng 8-22: Middleware function
module.exports = function(req, res, next) {
  // D√≤ng 9: L·∫•y token t·ª´ header
  const token = req.header("x-auth-token");

  // D√≤ng 11-13: Ki·ªÉm tra token c√≥ t·ªìn t·∫°i kh√¥ng
  if (!token) {
    return res.status(401).json({ message: "No token, authorization denied" });
  }

  try {
    // D√≤ng 16: Verify JWT token
    const decoded = jwt.verify(token, config.jwtSecret);
    req.user = decoded;
    next();
  } catch (e) {
    // D√≤ng 19-21: Handle invalid token
    res.status(400).json({ message: "Token is not valid" });
  }
};
```

### 3. **PRODUCT SERVICE** - Qu·∫£n l√Ω s·∫£n ph·∫©m

#### **3.1 App Class** (`product/src/app.js`)
```javascript
// D√≤ng 1-6: Import dependencies
const express = require("express");
const mongoose = require("mongoose");
const config = require("./config");
const MessageBroker = require("./utils/messageBroker");
const productsRouter = require("./routes/productRoutes");

// D√≤ng 8-15: Constructor
class App {
  constructor() {
    this.app = express();
    this.connectDB();
    this.setMiddlewares();
    this.setRoutes();
    this.setupMessageBroker();
  }

  // D√≤ng 35-36: Setup routes
  setRoutes() {
    this.app.use("/api/products", productsRouter);
  }

  // D√≤ng 39-41: Setup RabbitMQ connection
  setupMessageBroker() {
    MessageBroker.connect();
  }

  // D√≤ng 43-46: Start server on port 3001
  start() {
    this.server = this.app.listen(3001, () =>
      console.log("Server started on port 3001")
    );
  }
}
```

#### **3.2 Product Routes** (`product/src/routes/productRoutes.js`)
```javascript
// D√≤ng 1-6: Import dependencies
const express = require("express");
const ProductController = require("../controllers/productController");
const isAuthenticated = require("../utils/isAuthenticated");

// D√≤ng 8-9: Setup router v√† controller
const router = express.Router();
const productController = new ProductController();

// D√≤ng 11-13: Define routes v·ªõi authentication middleware
router.post("/", isAuthenticated, productController.createProduct);
router.post("/buy", isAuthenticated, productController.createOrder);
router.get("/", isAuthenticated, productController.getProducts);
```

#### **3.3 Product Controller** (`product/src/controllers/productController.js`)

**Create Product Flow:**
```javascript
// D√≤ng 17-37: createProduct method
async createProduct(req, res, next) {
  try {
    // D√≤ng 19-22: Ki·ªÉm tra authorization header
    const token = req.headers.authorization;
    if (!token) {
      return res.status(401).json({ message: "Unauthorized" });
    }

    // D√≤ng 23: T·∫°o Product instance t·ª´ request body
    const product = new Product(req.body);

    // D√≤ng 25-28: Validate product data
    const validationError = product.validateSync();
    if (validationError) {
      return res.status(400).json({ message: validationError.message });
    }

    // D√≤ng 30: Save product to database
    await product.save({ timeout: 30000 });

    // D√≤ng 32: Return created product
    res.status(201).json(product);
  } catch (error) {
    // D√≤ng 33-36: Handle errors
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
}
```

**Create Order Flow (Ph·ª©c t·∫°p nh·∫•t):**
```javascript
// D√≤ng 39-86: createOrder method
async createOrder(req, res, next) {
  try {
    // D√≤ng 41-44: Ki·ªÉm tra authentication
    const token = req.headers.authorization;
    if (!token) {
      return res.status(401).json({ message: "Unauthorized" });
    }

    // D√≤ng 46-47: L·∫•y product IDs t·ª´ request body
    const { ids } = req.body;
    const products = await Product.find({ _id: { $in: ids } });

    // D√≤ng 49-55: T·∫°o order ID v√† l∆∞u v√†o ordersMap
    const orderId = uuid.v4();
    this.ordersMap.set(orderId, { 
      status: "pending", 
      products, 
      username: req.user.username
    });

    // D√≤ng 57-61: G·ª≠i message ƒë·∫øn RabbitMQ orders queue
    await messageBroker.publishMessage("orders", {
      products,
      username: req.user.username,
      orderId,
    });

    // D√≤ng 63-71: Consume message t·ª´ products queue
    messageBroker.consumeMessage("products", (data) => {
      const orderData = JSON.parse(JSON.stringify(data));
      const { orderId } = orderData;
      const order = this.ordersMap.get(orderId);
      if (order) {
        this.ordersMap.set(orderId, { ...order, ...orderData, status: 'completed' });
        console.log("Updated order:", order);
      }
    });

    // D√≤ng 74-78: Long polling ƒë·ªÉ ch·ªù order completed
    let order = this.ordersMap.get(orderId);
    while (order.status !== 'completed') {
      await new Promise(resolve => setTimeout(resolve, 1000));
      order = this.ordersMap.get(orderId);
    }

    // D√≤ng 80-81: Return completed order
    return res.status(201).json(order);
  } catch (error) {
    // D√≤ng 82-85: Handle errors
    console.error(error);
    res.status(500).json({ message: "Server error" });
  }
}
```

#### **3.4 Message Broker** (`product/src/utils/messageBroker.js`)
```javascript
// D√≤ng 1-6: Import amqplib v√† define MessageBroker class
const amqp = require("amqplib");

class MessageBroker {
  constructor() {
    this.channel = null;
  }

  // D√≤ng 8-21: Connect to RabbitMQ
  async connect() {
    console.log("Connecting to RabbitMQ...");
    setTimeout(async () => {
      try {
        const connection = await amqp.connect("amqp://rabbitmq:5672");
        this.channel = await connection.createChannel();
        await this.channel.assertQueue("products");
        console.log("RabbitMQ connected");
      } catch (err) {
        console.error("Failed to connect to RabbitMQ:", err.message);
      }
    }, 20000);
  }

  // D√≤ng 23-37: Publish message to queue
  async publishMessage(queue, message) {
    if (!this.channel) {
      console.error("No RabbitMQ channel available.");
      return;
    }
    try {
      await this.channel.sendToQueue(queue, Buffer.from(JSON.stringify(message)));
    } catch (err) {
      console.log(err);
    }
  }

  // D√≤ng 39-55: Consume message from queue
  async consumeMessage(queue, callback) {
    if (!this.channel) {
      console.error("No RabbitMQ channel available.");
      return;
    }
    try {
      await this.channel.consume(queue, (message) => {
        const content = message.content.toString();
        const parsedContent = JSON.parse(content);
        callback(parsedContent);
        this.channel.ack(message);
      });
    } catch (err) {
      console.log(err);
    }
  }
}
```

### 4. **ORDER SERVICE** - X·ª≠ l√Ω ƒë∆°n h√†ng

#### **4.1 App Class** (`order/src/app.js`)
```javascript
// D√≤ng 1-6: Import dependencies
const express = require("express");
const mongoose = require("mongoose");
const Order = require("./models/order");
const amqp = require("amqplib");
const config = require("./config");

// D√≤ng 7-12: Constructor
class App {
  constructor() {
    this.app = express();
    this.connectDB();
    this.setupOrderConsumer();
  }

  // D√≤ng 27-68: Setup RabbitMQ consumer
  async setupOrderConsumer() {
    console.log("Connecting to RabbitMQ...");
    
    setTimeout(async () => {
      try {
        // D√≤ng 33: Connect to RabbitMQ
        const amqpServer = "amqp://rabbitmq:5672";
        const connection = await amqp.connect(amqpServer);
        console.log("Connected to RabbitMQ");
        
        // D√≤ng 35-36: Create channel v√† assert queue
        const channel = await connection.createChannel();
        await channel.assertQueue("orders");

        // D√≤ng 38-63: Consume messages t·ª´ orders queue
        channel.consume("orders", async (data) => {
          console.log("Consuming ORDER service");
          
          // D√≤ng 41: Parse message data
          const { products, username, orderId } = JSON.parse(data.content);

          // D√≤ng 43-47: T·∫°o Order instance
          const newOrder = new Order({
            products,
            user: username,
            totalPrice: products.reduce((acc, product) => acc + product.price, 0),
          });

          // D√≤ng 49-50: Save order to database
          await newOrder.save();

          // D√≤ng 52-54: Send ACK
          channel.ack(data);
          console.log("Order saved to DB and ACK sent to ORDER queue");

          // D√≤ng 56-62: Send message to products queue
          const { user, products: savedProducts, totalPrice } = newOrder.toJSON();
          channel.sendToQueue(
            "products",
            Buffer.from(JSON.stringify({ orderId, user, products: savedProducts, totalPrice }))
          );
        });
      } catch (err) {
        console.error("Failed to connect to RabbitMQ:", err.message);
      }
    }, 10000);
  }
}
```

## üîÑ LU·ªíNG HO·∫†T ƒê·ªòNG T·ªîNG TH·ªÇ

### **Scenario: User ƒë·∫∑t h√†ng**

1. **User Login:**
   ```
   POST localhost:3003/auth/login
   ‚Üí API Gateway ‚Üí Auth Service (3000)
   ‚Üí Return JWT Token
   ```

2. **User t·∫°o s·∫£n ph·∫©m:**
   ```
   POST localhost:3003/products
   ‚Üí API Gateway ‚Üí Product Service (3001)
   ‚Üí Save to MongoDB
   ```

3. **User ƒë·∫∑t h√†ng:**
   ```
   POST localhost:3003/products/buy
   ‚Üí API Gateway ‚Üí Product Service (3001)
   ‚Üí Publish message to RabbitMQ "orders" queue
   ‚Üí Order Service (3002) consumes message
   ‚Üí Order Service saves order to MongoDB
   ‚Üí Order Service publishes to "products" queue
   ‚Üí Product Service receives confirmation
   ‚Üí Return order details to user
   ```

## üß™ TEST CASES

### **Auth Service Tests** (`auth/src/test/authController.test.js`)
- ‚úÖ Register new user
- ‚úÖ Register duplicate username (should fail)
- ‚úÖ Login with valid credentials
- ‚úÖ Login with invalid credentials
- ‚úÖ Login with wrong password

### **Product Service Tests** (`product/src/test/product.test.js`)
- ‚úÖ Create product with valid data
- ‚úÖ Create product with missing name (should fail)
- ‚úÖ Authentication required for all endpoints

## üîß CONFIGURATION

### **Environment Variables:**
- `MONGODB_AUTH_URI`: MongoDB connection cho Auth service
- `MONGODB_PRODUCT_URI`: MongoDB connection cho Product service  
- `MONGODB_ORDER_URI`: MongoDB connection cho Order service
- `JWT_SECRET`: Secret key cho JWT tokens
- `RABBITMQ_URI`: RabbitMQ connection string

### **Ports:**
- API Gateway: 3003
- Auth Service: 3000
- Product Service: 3001
- Order Service: 3002

## üöÄ DEPLOYMENT REQUIREMENTS

1. **Docker containers** cho t·∫•t c·∫£ services
2. **MongoDB** database
3. **RabbitMQ** message broker
4. **Network isolation** - ch·ªâ API Gateway accessible t·ª´ b√™n ngo√†i
5. **CI/CD pipeline** v·ªõi GitHub Actions
6. **Integration tests** ƒë·∫£m b·∫£o t·∫•t c·∫£ requests qua API Gateway

## ‚ö†Ô∏è SECURITY NOTES

- T·∫•t c·∫£ services ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi API Gateway
- Kh√¥ng ƒë∆∞·ª£c truy c·∫≠p tr·ª±c ti·∫øp v√†o internal services
- JWT tokens ƒë∆∞·ª£c s·ª≠ d·ª•ng cho authentication
- Passwords ƒë∆∞·ª£c hash v·ªõi bcrypt
- Message queues ƒë·∫£m b·∫£o asynchronous communication
